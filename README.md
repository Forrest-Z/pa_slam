# pa_slam
LiDAR based SLAM. This SLAM was implemented by Remy Guyonneau and is based on the work of Sebastien Lagrange and Philippe Lucidarme.

Here is the output of the demo (screen captured from rviz):

![Image of PaSLAM](images/demo.png)

This package has been tested with:
 - Ubuntu 18.04
 - ROS melodic
 
## Basic SLAM idea

This is a LiDAR only 2D SLAM (Simultaneous Localization and Mapping) approach. The objective is to estimate the 2D environment using a probability map, i.e. a grid in wich each cell contains a probability score of being an obstacle in the environment.

To do that, two maps are considered: a probability map, to store the environment modelization, and a cost map that stores for each cell the distance to the closest obstacle. The cost map is used to be able to give a score (sum of distances) for a LiDAR scan according to a 2d pose (x, y, theta). This give us a cost function.

Using the cost function, a nelder and mead algorithm is considered to "map" new measurement into the map (https://en.wikipedia.org/wiki/Nelder%E2%80%93Mead_method).

# package organization

The package has been created with the catkin_create_pkg command. Here is an overview of the files:

 - pa_slam
   - CMakeLists.txt : generated by catkin_create_pkg and modified to fit the ros package
   - LICENSE : generated automatically by github
   - README.md : this file
   - package.xml : basic informations about this package
   - pa_slam_node.cpp : source code of the node that uses the SLAM classes to create a map
   - images
     - demo.png : a screen capture of the demo results
   - launch
     - demo_pa_slam.launch : a launch file to start the demo
     - pa_slam.launch : a launch file example to start the node with some parameters
   - rosbag
     - demo.bag : a rosbag created for the slam demo
   - rviz
     - demo.rviz : an rviz configuration made for the demo
   - src
     - PaSLAM.cpp/.h : the PaSLAM class, this is the main class that implemented the nelder and mead algorithm to compute the best transformation for LiDAR data according to the current map
     - PaSLAM_Costmap.cpp/.h : the PaSLAM_Costmap class, this class allows to compute costs, used for the evaluation function
     - PaSLAM_Map.cpp/.h : the PaSLAM_Map class, this class allows to manipulate the probability map
   - output
     - This folder is empty, if you start the demo and you save the map as csv file, it should be saved here
## The classes

### IstiaSlam

This class is the main class of the SLAM approach. It has an IstiaSlam_Map variable to handle the probability map and the cost map. It also contains the Nelder and Mead algorithm implementation.

Here are the usefull methods of the class:

````
    // function that add the laser scan in the map considering that the sensor is at a pose pose
    void add_2_map(const sensor_msgs::LaserScan &scan, const geometry_msgs::Pose2D& pose);

    // to publish the probability map
    void publish_probability_map();
    
    // to convert the costmap into a grid map and publish it (debugging purpose)
    void publish_cost_map();

    // evaluate the cost of a laser scan according to the pose pose_init (the cost is based on the cost map)
    double get_cost(const sensor_msgs::LaserScan &scan, const geometry_msgs::Pose2D& pose_init);
    
    // implementation of the wikipedia nelder mead algorithm
    geometry_msgs::Pose2D nelder_mead(const sensor_msgs::LaserScan &scan, const geometry_msgs::Pose2D& pose_init);
````

### IstiaSlam_Map

This class handles the probability map and the cost map. The probability map is saved in a nav_msgs::OccupancyGrid variable. The cost map is based on a custom costmap class presented bellow. 

### IstiaSlam_Costmap

This class allows to handle the cost map.


# to start the demo

After building the package 
```
    catkin_make
```
You should be able to run the demo launch file:
```
    roslaunch pa_slam demo_pa_slam.launch
```
This should starts: the slam node, the rosbag and rviz
